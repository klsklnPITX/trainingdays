<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Break Out #2: Add a serverless microservice to our sample app and include messaging | Azure Developer College</title>
    <meta name="generator" content="VuePress 1.6.0">
    
    <meta name="description" content="">
    <link rel="preload" href="/trainingdays/assets/css/0.styles.b2170ae1.css" as="style"><link rel="preload" href="/trainingdays/assets/js/app.d5b0c7b2.js" as="script"><link rel="preload" href="/trainingdays/assets/js/2.d193ccda.js" as="script"><link rel="preload" href="/trainingdays/assets/js/21.f2cd341d.js" as="script"><link rel="prefetch" href="/trainingdays/assets/js/10.67c160c1.js"><link rel="prefetch" href="/trainingdays/assets/js/11.72a1cc0e.js"><link rel="prefetch" href="/trainingdays/assets/js/12.9a53b9c0.js"><link rel="prefetch" href="/trainingdays/assets/js/13.f485a8b7.js"><link rel="prefetch" href="/trainingdays/assets/js/14.c8a2d557.js"><link rel="prefetch" href="/trainingdays/assets/js/15.2344745e.js"><link rel="prefetch" href="/trainingdays/assets/js/16.2dba3dc8.js"><link rel="prefetch" href="/trainingdays/assets/js/17.898ac6c2.js"><link rel="prefetch" href="/trainingdays/assets/js/18.c385c1dc.js"><link rel="prefetch" href="/trainingdays/assets/js/19.940c0806.js"><link rel="prefetch" href="/trainingdays/assets/js/20.ec9efb1d.js"><link rel="prefetch" href="/trainingdays/assets/js/22.eb03fe7a.js"><link rel="prefetch" href="/trainingdays/assets/js/23.81b99427.js"><link rel="prefetch" href="/trainingdays/assets/js/24.e7ce36a3.js"><link rel="prefetch" href="/trainingdays/assets/js/25.31d0a173.js"><link rel="prefetch" href="/trainingdays/assets/js/26.4f40f0f3.js"><link rel="prefetch" href="/trainingdays/assets/js/27.794ebcce.js"><link rel="prefetch" href="/trainingdays/assets/js/28.73d08b43.js"><link rel="prefetch" href="/trainingdays/assets/js/29.7cc71b70.js"><link rel="prefetch" href="/trainingdays/assets/js/3.9c4ba6fd.js"><link rel="prefetch" href="/trainingdays/assets/js/30.a39812d2.js"><link rel="prefetch" href="/trainingdays/assets/js/31.718a432b.js"><link rel="prefetch" href="/trainingdays/assets/js/32.36027fec.js"><link rel="prefetch" href="/trainingdays/assets/js/33.c6f2c1a2.js"><link rel="prefetch" href="/trainingdays/assets/js/34.9e10be9f.js"><link rel="prefetch" href="/trainingdays/assets/js/35.0b6f8143.js"><link rel="prefetch" href="/trainingdays/assets/js/36.59329508.js"><link rel="prefetch" href="/trainingdays/assets/js/37.95357cee.js"><link rel="prefetch" href="/trainingdays/assets/js/38.5ea75242.js"><link rel="prefetch" href="/trainingdays/assets/js/39.88f1f1a0.js"><link rel="prefetch" href="/trainingdays/assets/js/4.7127bc0f.js"><link rel="prefetch" href="/trainingdays/assets/js/40.9796f4b5.js"><link rel="prefetch" href="/trainingdays/assets/js/41.e86cd474.js"><link rel="prefetch" href="/trainingdays/assets/js/42.29e69a93.js"><link rel="prefetch" href="/trainingdays/assets/js/43.d90b1d62.js"><link rel="prefetch" href="/trainingdays/assets/js/44.669f08a4.js"><link rel="prefetch" href="/trainingdays/assets/js/45.75c3a7f6.js"><link rel="prefetch" href="/trainingdays/assets/js/46.a34b68ee.js"><link rel="prefetch" href="/trainingdays/assets/js/47.4d395e5f.js"><link rel="prefetch" href="/trainingdays/assets/js/48.454c5344.js"><link rel="prefetch" href="/trainingdays/assets/js/49.02f3363f.js"><link rel="prefetch" href="/trainingdays/assets/js/5.409afd20.js"><link rel="prefetch" href="/trainingdays/assets/js/50.af75c209.js"><link rel="prefetch" href="/trainingdays/assets/js/51.97fe1d75.js"><link rel="prefetch" href="/trainingdays/assets/js/52.dcda9a68.js"><link rel="prefetch" href="/trainingdays/assets/js/53.003bf84b.js"><link rel="prefetch" href="/trainingdays/assets/js/54.62e34f71.js"><link rel="prefetch" href="/trainingdays/assets/js/55.9a801657.js"><link rel="prefetch" href="/trainingdays/assets/js/56.e85ebf52.js"><link rel="prefetch" href="/trainingdays/assets/js/57.727dde6e.js"><link rel="prefetch" href="/trainingdays/assets/js/58.3a1b26b1.js"><link rel="prefetch" href="/trainingdays/assets/js/59.a96ff538.js"><link rel="prefetch" href="/trainingdays/assets/js/6.299e2302.js"><link rel="prefetch" href="/trainingdays/assets/js/60.f1d2c5f4.js"><link rel="prefetch" href="/trainingdays/assets/js/61.04124f07.js"><link rel="prefetch" href="/trainingdays/assets/js/62.daaabae4.js"><link rel="prefetch" href="/trainingdays/assets/js/63.c3ac4497.js"><link rel="prefetch" href="/trainingdays/assets/js/64.39bac290.js"><link rel="prefetch" href="/trainingdays/assets/js/65.958ec7f1.js"><link rel="prefetch" href="/trainingdays/assets/js/66.1a1c6782.js"><link rel="prefetch" href="/trainingdays/assets/js/67.c3d23971.js"><link rel="prefetch" href="/trainingdays/assets/js/68.21fc5c8d.js"><link rel="prefetch" href="/trainingdays/assets/js/69.bf625936.js"><link rel="prefetch" href="/trainingdays/assets/js/7.b4b76ad9.js"><link rel="prefetch" href="/trainingdays/assets/js/70.7cd86c9d.js"><link rel="prefetch" href="/trainingdays/assets/js/71.36cfe2c7.js"><link rel="prefetch" href="/trainingdays/assets/js/72.8d76e2a1.js"><link rel="prefetch" href="/trainingdays/assets/js/73.2d5f43ad.js"><link rel="prefetch" href="/trainingdays/assets/js/74.11628563.js"><link rel="prefetch" href="/trainingdays/assets/js/75.54800e63.js"><link rel="prefetch" href="/trainingdays/assets/js/8.5d78ef56.js"><link rel="prefetch" href="/trainingdays/assets/js/9.0864e018.js">
    <link rel="stylesheet" href="/trainingdays/assets/css/0.styles.b2170ae1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/trainingdays/" class="home-link router-link-active"><!----> <span class="site-name">Azure Developer College</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/trainingdays/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/trainingdays/day1/" class="sidebar-link">Day 1 Azure Fundamentals &amp; Infrastructure</a></li><li><a href="/trainingdays/day2/" aria-current="page" class="sidebar-link">Day 2 Azure Development</a></li><li><a href="/trainingdays/day3/" class="sidebar-link">Day 3 Data and AI</a></li><li><a href="/trainingdays/day4/" class="sidebar-link">Day 4 Azure DevOps</a></li><li><a href="/trainingdays/day5/" class="sidebar-link">Day 5 Identity and Architecture</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="break-out-2-add-a-serverless-microservice-to-our-sample-app-and-include-messaging"><a href="#break-out-2-add-a-serverless-microservice-to-our-sample-app-and-include-messaging" class="header-anchor">#</a> Break Out #2: Add a serverless microservice to our sample app and include messaging</h1> <p>Time for our second &quot;Break-Out&quot; session!</p> <p>We now will deploy all required services of our SCM Contacts Management app to Azure, inlcuding the VueJS Single Page Application. To host the SPA (which is basically a static website), we make use of the &quot;Static Website Hosting&quot; option of Azure Storage Accounts - which is the cheapest option to host applications built e.g. with Angular, React or like in our case VueJS.</p> <p>We also add a second service, that let's us save images for contacts. That service will be implemented in .NET Core and will use Azure Storage Queues (to make you familiar with another messaging service) to notify an Azure Function that in turn creates thumbnails of the images. The results will then be saved in an Azure Storage Account.</p> <p>At the end of the day, this will be the architecture of our SCM Contacts Management application:</p> <p><img src="/trainingdays/assets/img/architecture_day2.697228e8.png" alt="architecture_day2" title="architecture_day2"></p> <h2 id="services-to-handle-contact-images"><a href="#services-to-handle-contact-images" class="header-anchor">#</a> Services to handle Contact Images</h2> <p>We will start implementing our target architecture by adding a Storage Account to save contact images.</p> <h3 id="storage-account-container-queue"><a href="#storage-account-container-queue" class="header-anchor">#</a> Storage Account (Container/Queue)</h3> <p>Therefore, create a Storage Account in the resource group you took for the first breakout session (should be <strong>scm-breakout-rg</strong>). Create the account having these paramters:</p> <ul><li>name the storage account <em>&lt;YOUR_PREFIX&gt;scmresources</em></li> <li>Location: <em>West Europe</em></li> <li>Performance: <em>Standard</em></li> <li>Account Kind: <em>Storage V2</em></li> <li>Replication: <em>LRS</em></li> <li>Access Tier: <em>Hot</em></li></ul> <p>When the Storage Account has been created, add two containers where we will be storing the images:</p> <ul><li><em>rawimages</em> <ul><li>Public Access Level: <em>Blob</em></li></ul></li> <li><em>thumbnails</em> <ul><li>Public Access Level: <em>Blob</em></li></ul></li></ul> <p>Also, add a new <strong><em>Queue</em></strong> in your Storage Account. Name the queue <code>thumbnails</code>.</p> <p>The infrastructure for handling images regarding storage and messaging is now set up.</p> <h3 id="azure-function-for-image-manipulation"><a href="#azure-function-for-image-manipulation" class="header-anchor">#</a> Azure Function for Image Manipulation</h3> <p>In the <em>Serveless</em> challenge, we created the Azure Function via the Visual Studio Code wizard. Now, let's see how the the Portal experience is like.</p> <p>Go to your resource group (<strong>scm-breakout-rg</strong>) and add an Azure Function (in the wizard, search for &quot;Function App&quot;).</p> <p>Follow the wizard and when asked, enter the following information (only important information will be mentioned):</p> <ul><li>Basic Tab
<ul><li>Function App name: choose a globally unique name</li> <li>Publish: <em>Code</em></li> <li>Runtime Stack: <em>.NET Core</em></li> <li>Region: <em>West Europe</em></li></ul></li> <li>Hosting Tab
<ul><li>Storage Account: choose the one you created above</li> <li>Operating System: <em>Windows</em></li> <li>Plan Type: <em>Consumption</em></li></ul></li> <li>Monitoring
<ul><li>Enable AppInsights: <em>No</em></li></ul></li></ul> <p><img src="/trainingdays/assets/img/portal_bo2_func.799ea668.png" alt="portal_bo2_func" title="portal_bo2_func"></p> <p>When the Function has been created, we need to add a few <strong>Configuration settings</strong> that our image manipulation function needs to be working correctly.</p> <p>Please open the Azure Function and switch to the <strong>Configuration</strong> view.</p> <p>Add the following Configuration settings:</p> <table><thead><tr><th>Name</th> <th>Value / Hints</th></tr></thead> <tbody><tr><td>QueueName</td> <td><em>thumbnails</em></td></tr> <tr><td>StorageAccountConnectionString</td> <td>take the <strong>Connection String</strong> from your Storage Account (under <strong><em>Access Keys</em></strong>)</td></tr> <tr><td>ImageProcessorOptions__StorageAccountConnectionString</td> <td>take the <strong>Connection String</strong> from your Storage Account (under <strong><em>Access Keys</em></strong>)</td></tr> <tr><td>ImageProcessorOptions__ImageWidth</td> <td><em>100</em></td></tr></tbody></table> <hr> <br>
Save your settings. The Functions app will now restart to apply your changes.
<p>It's time to deploy the Image Resizer Function App to Azure.</p> <p><span style="color:red;"><strong>Important</strong></span>: You need to open a new Visual Studio Code window and open folder <strong>day2/apps/dotnetcore/Scm.Resources/Adc.Scm.Resources.ImageResizer</strong>. The deployment steps have to be done in that new window!</p> <p>To deploy the function follow these steps:</p> <ul><li>go to the <strong>Azure Tools</strong> extension</li> <li>in the Functions section, choose your Azure Function you created previously</li> <li>right-click on it, choose &quot;Deploy to Function App...&quot;</li></ul> <p>Deployment of you function starts and after a few seconds, it is running in Azure. You can close that window now.</p> <h3 id="deploy-the-azure-web-app-providing-the-api-to-store-images"><a href="#deploy-the-azure-web-app-providing-the-api-to-store-images" class="header-anchor">#</a> Deploy the Azure Web App providing the API to store images</h3> <p>We need to add another Azure Web App to host the &quot;Resources API&quot; of our SCM Contacts application.</p> <ol><li>got to your resource group <strong>scm-breakout-rg</strong></li> <li>create an Azure Web App (you can choose to use the Portal or the Azure CLI: OS - <strong>Windows</strong>, RuntimeStack - <strong>.NET Core 3.1 (LTS)</strong>, Size - <strong>S1</strong>, AppInsights is not needed at the moment). You can choose the same settings as for the Contacts API.</li></ol> <p>When the deployment has finished, we also need to add a few settings. Open the Web App in the Portal and go to the &quot;Configuration&quot; view (under <strong>Settings</strong>).</p> <p>Add the following parameters:</p> <table><thead><tr><th>Name</th> <th>Value / Hints</th></tr></thead> <tbody><tr><td>ImageStoreOptions__StorageAccountConnectionString</td> <td>take the <strong>Connection String</strong> from your Storage Account created in this Break Out session (under <strong><em>Access Keys</em></strong>)</td></tr> <tr><td>StorageQueueOptions__StorageAccountConnectionString</td> <td>take the <strong>Connection String</strong> from your Storage Account created in this Break Out session (under <strong><em>Access Keys</em></strong>)</td></tr> <tr><td>ImageStoreOptions__ImageContainer</td> <td><em>rawimages</em></td></tr> <tr><td>StorageQueueOptions__ImageContainer</td> <td><em>rawimages</em></td></tr> <tr><td>ImageStoreOptions__ThumbnailContainer</td> <td><em>thumbnails</em></td></tr> <tr><td>StorageQueueOptions__Queue</td> <td><em>thumbnails</em></td></tr> <tr><td>StorageQueueOptions__ThumbnailContainer</td> <td><em>thumbnails</em></td></tr></tbody></table> <hr> <br> <p>Now, go back to Visual Studio Code and deploy the Resources API from folder <em>day2/apps/dotnetcore/Scm.Resources/Adc.Scm.Resources.Api</em> to the Azure Web App.</p> <p>You have done this several times now and should be familiar with the process. For your convenience, we added (as in Break Out Session 1) a task that publishes the .NET Core API to a local folder that you can use as deployment source for the Azure Web App:</p> <ul><li>press <strong>F1</strong> and choose <strong>&quot;Tasks: Run Task&quot;</strong></li> <li>select <strong>day2publishScmResources</strong></li> <li>outputs of the build will be placed in <strong>day2/apps/dotnetcore/Scm.Resources/Adc.Scm.Resources.Api/publish</strong></li> <li>choose that folder when &quot;right-click-deploying&quot; from the <strong>Azure Tools / AppService</strong> extension (via &quot;Browse...&quot;)</li></ul> <p>Time for testing!</p> <h2 id="test-with-you-local-single-page-application"><a href="#test-with-you-local-single-page-application" class="header-anchor">#</a> Test with you local Single Page Application</h2> <p>When everything has been deployed to Azure, open the <strong>settings.js</strong> file of your SPA (folder <em>day2/apps/frontend/scmfe/public/settings</em>) and adjust the <strong>resourcesEndpoint</strong> property (also make sure, that <strong>endpoint</strong> points to the Contacts API in Azure). Enter the value of your newly deployed Resources API for it, e.g. https://scmimageresource.azurewebsites.net/.</p> <p>Switch to the &quot;Debug&quot; view and start the Single Page Application (dropdown: <strong>Day2 - Launch Frontend</strong>).</p> <blockquote><p>There <strong>may</strong> be a problem when running that debug configuration. In case &quot;npm&quot; cannot be started, please go to the commandline and run <code>npm run serve</code>!</p></blockquote> <p>To test everything we just set up, create a new <em>Contact</em> and open the details of it afterwards. On the right side box, you should now see a button called &quot;<strong>CHANGE AVATAR</strong>&quot;.</p> <p><img src="/trainingdays/assets/img/browser_avatar.4790f507.png" alt="browser_avatar" title="browser_avatar"></p> <p>Upload a picture and save the Contact afterwards.</p> <h2 id="host-the-single-page-application-in-azure"><a href="#host-the-single-page-application-in-azure" class="header-anchor">#</a> Host the Single Page Application in Azure</h2> <p>We still run the Single Page Application on our local machine. Time to switch to hosting in Azure. As mentioned before, we make use of the &quot;Static Website&quot; feature of Azure Storage Accounts.</p> <p>It's very simple to use. Create a new Azure Storage Account (or you can reuse the Storage Account for the images/queue). When deployment of the Storage Account is finished, go to &quot;Static website&quot; (under <strong>Settings</strong>) and enable it. As <em>Index document name</em> and <em>Error document path</em>, choose &quot;index.html&quot;.</p> <p><img src="/trainingdays/assets/img/portal_static_website.6c827797.png" alt="portal_static_website" title="portal_static_website"></p> <blockquote><p>When you save the settings, Azure will create a new container called <strong>$web</strong> where you can copy static (web) file to. Azure will serve the contents of this containers as &quot;Static Website&quot;.</p></blockquote> <p>Now open a commandline, go to folder <em>day2/apps/frontend/scmfe</em> and execute:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">npm</span> run build

<span class="token operator">&gt;</span> scmfe@0.1.0 build /Users/christiandennig/dev/azure-developer-college/day2/apps/frontend/scmfe
<span class="token operator">&gt;</span> vue-cli-service build

   Building <span class="token keyword">for</span> production<span class="token punctuation">..</span>.
   <span class="token punctuation">..</span>.
   <span class="token punctuation">..</span>.
   <span class="token punctuation">..</span>
   <span class="token builtin class-name">.</span>

 DONE  Build complete. The dist directory is ready to be deployed.
</code></pre></div><p>This starts a local build of the VueJS application, which puts all results/artifacts (the static website itself) into the <strong>dist</strong> folder. When the build has finished, copy the content of that <em>dist</em> folder via the Storage Explorer to your Storage Account in the <strong><em>$web</em></strong> container.</p> <p><img src="/trainingdays/assets/img/storage_explorer_static_website.f7d7d5ae.png" alt="storage_explorer_static_website" title="storage_explorer_static_website"></p> <p>Now open the URL for the frontend (you can find it after saving the settings of the Static website under <strong>Primary Endpoint</strong>) and check that the application is up and running.</p> <p><img src="/trainingdays/assets/img/portal_static_url.30e81df2.png" alt="portal_static_url" title="portal_static_url"></p> <h1 id="wrap-up"><a href="#wrap-up" class="header-anchor">#</a> Wrap-Up</h1> <p><strong><em>Congratulations</em></strong>! You have just created your first modern, multi-service Azure-backed application. You made use of Azure AppServices, Storage Accounts, Messaging (Azure Storage Queues), serverless Azure Function Apps and static website hosting. All in combination with a modern VueJS frontend that is also working on mobile devices!</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/trainingdays/edit/master/day2/challenges/challenge-bo-2.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/trainingdays/assets/js/app.d5b0c7b2.js" defer></script><script src="/trainingdays/assets/js/2.d193ccda.js" defer></script><script src="/trainingdays/assets/js/21.f2cd341d.js" defer></script>
  </body>
</html>
